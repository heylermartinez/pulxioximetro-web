<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monitoreo Hospitalario - Simulaci√≥n</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg-dark: #0e141a;
      --card-bg: #161d25;
      --text-light: #e0e6ed;
      --gray: #a0aab5;
      --border: #2a333d;
      --danger: #ff4c4c;
      --success: #00e676;
      --accent: #3a8ef6;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--bg-dark);
      color: var(--text-light);
      padding: 15px;
      min-height: 100vh;
    }

    header {
      text-align: center;
      margin-bottom: 25px;
      padding: 15px;
      background: linear-gradient(135deg, #1c2633, #2a3a4c);
      color: var(--text-light);
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    }

    header h1 {
      font-size: 22px;
      margin-bottom: 6px;
      color: var(--success);
      letter-spacing: 0.5px;
    }

    header p {
      font-size: 13px;
      color: var(--gray);
    }

    .connection-status {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 15px;
      font-size: 13px;
    }

    .connection-status span {
      color: var(--success);
      font-weight: 600;
    }

    .patient-form {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 25px;
    }

    .patient-form h2 {
      font-size: 16px;
      margin-bottom: 15px;
      color: var(--accent);
    }

    .patient-form input,
    .patient-form select {
      width: 100%;
      margin-bottom: 12px;
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background-color: #0e141a;
      color: var(--text-light);
      font-size: 13px;
    }

    .patient-form button {
      background: var(--accent);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
      transition: 0.2s;
    }

    .patient-form button:hover {
      background: #5597f9;
    }

    .patient-card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      margin-bottom: 25px;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
      padding: 18px;
      font-size: 13px;
    }

    .patient-card h2 {
      font-size: 17px;
      margin-bottom: 5px;
      color: var(--text-light);
      font-weight: 600;
    }

    .patient-card .info {
      color: var(--gray);
      margin-bottom: 10px;
      font-size: 12px;
    }

    .btn {
      border: none;
      border-radius: 6px;
      padding: 5px 10px;
      margin-right: 6px;
      font-size: 12px;
      cursor: pointer;
      transition: 0.2s;
    }

    .stop-btn { background-color: var(--success); color: #0e141a; font-weight: bold; }
    .delete-btn { background-color: var(--danger); color: white; }
    .export-btn { background-color: var(--accent); color: white; }

    .btn:hover { transform: scale(1.05); }

    canvas {
      width: 100%;
      height: 180px !important;
      margin-top: 10px;
      background-color: #0e141a;
      border-radius: 6px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    th {
      background: #222b35;
      color: var(--text-light);
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    td {
      padding: 6px 8px;
      border-bottom: 1px solid var(--border);
      color: var(--text-light);
    }

    tbody tr:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }

    .history-container {
      max-height: 160px;
      overflow-y: auto;
      border: 1px solid var(--border);
      border-radius: 6px;
      margin-top: 10px;
    }

    h3 {
      color: var(--accent);
      font-size: 14px;
      margin-top: 15px;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>

  <header>
    <h1>ü©∫ Monitoreo de Pacientes</h1>
    <p>Simulaci√≥n hospitalaria en tiempo real</p>
  </header>

  <div class="connection-status">
    <span>üü¢ Simulaci√≥n Activa</span>
  </div>

  <div class="patient-form">
    <h2>Registrar Nuevo Paciente</h2>
    <input type="text" id="name" placeholder="Nombre completo">
    <input type="text" id="id" placeholder="Documento o ID">
    <input type="number" id="age" placeholder="Edad">
    <select id="sex">
      <option value="">Sexo</option>
      <option value="Masculino">Masculino</option>
      <option value="Femenino">Femenino</option>
    </select>
    <button onclick="addPatient()">Agregar Paciente</button>
  </div>

  <div id="patientsContainer"></div>

  <script>
    let patients = [];

    function addPatient() {
      let name = document.getElementById("name").value.trim();
      let id = document.getElementById("id").value.trim();
      let age = document.getElementById("age").value.trim();
      let sex = document.getElementById("sex").value;

      if (!name || !id || !age || !sex) {
        return alert("Por favor completa todos los campos");
      }

      let container = document.createElement("div");
      container.className = "patient-card";
      container.id = `card_${id}`;
      container.innerHTML = `
        <h2>üë§ ${name}</h2>
        <p class="info">üÜî ID: ${id} | üéÇ Edad: ${age} | üë§ Sexo: ${sex}</p>
        <button class="btn stop-btn" onclick="toggleMonitoring('${id}')">‚õî Detener</button>
        <button class="btn export-btn" onclick="exportHistoryToCSV('${id}', '${name}')">üßæ Exportar CSV</button>
        <button class="btn delete-btn" onclick="deletePatient('${id}', '${name}')">üóëÔ∏è Eliminar</button>
        <canvas id="chart_${id}" height="150"></canvas>
        <h3>Historial</h3>
        <div class="history-container">
          <table>
            <thead>
              <tr><th>Hora</th><th>SpO‚ÇÇ (%)</th><th>Pulso (BPM)</th></tr>
            </thead>
            <tbody id="table_${id}"></tbody>
          </table>
        </div>
      `;
      document.getElementById("patientsContainer").appendChild(container);

      let ctx = document.getElementById(`chart_${id}`).getContext("2d");
      let chart = new Chart(ctx, {
        type: "line",
        data: {
          labels: [],
          datasets: [
            { label: "SpO‚ÇÇ (%)", borderColor: "#00e676", pointBackgroundColor: "#00e676", borderWidth: 2, data: [], fill: false },
            { label: "Pulso (BPM)", borderColor: "#ff4c4c", pointBackgroundColor: "#ff4c4c", borderWidth: 2, data: [], fill: false }
          ]
        },
        options: {
          plugins: { legend: { labels: { color: "#e0e6ed", font: { size: 11 } } } },
          scales: {
            x: { ticks: { color: "#a0aab5" }, grid: { color: "#2a333d" } },
            y: { ticks: { color: "#a0aab5" }, grid: { color: "#2a333d" } }
          }
        }
      });

      patients.push({ id, name, chart, active: true });
      document.getElementById("name").value = "";
      document.getElementById("id").value = "";
      document.getElementById("age").value = "";
      document.getElementById("sex").value = "";
    }

    function toggleMonitoring(id) {
      let patient = patients.find(p => p.id === id);
      if (!patient) return;
      let btn = document.querySelector(`#card_${id} .stop-btn`);

      if (patient.active) {
        patient.active = false;
        btn.innerText = "‚ñ∂Ô∏è Reanudar";
        btn.style.backgroundColor = "#f6c343";
      } else {
        patient.active = true;
        btn.innerText = "‚õî Detener";
        btn.style.backgroundColor = "var(--success)";
      }
    }

    function exportHistoryToCSV(id, name) {
      let table = document.getElementById(`table_${id}`);
      if (!table) return alert("No hay datos para exportar.");

      let rows = [["Hora", "SpO‚ÇÇ (%)", "Pulso (BPM)"]];
      for (let r of table.rows) {
        let row = [];
        for (let cell of r.cells) row.push(cell.innerText);
        rows.push(row);
      }

      let csvContent = rows.map(e => e.join(",")).join("\n");
      let blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
      let link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = `Historial_${name}_${id}.csv`;
      link.click();
    }

    function deletePatient(id, name) {
      patients = patients.filter(p => p.id !== id);
      let card = document.getElementById(`card_${id}`);
      if (card) card.remove();
    }

    // üîπ Simulaci√≥n autom√°tica
    setInterval(() => {
      let time = new Date().toLocaleTimeString();
      patients.forEach(p => {
        if (!p.active) return;
        let spo2 = 95 + Math.floor(Math.random() * 5);
        let bpm = 70 + Math.floor(Math.random() * 15);

        p.chart.data.labels.push(time);
        p.chart.data.datasets[0].data.push(spo2);
        p.chart.data.datasets[1].data.push(bpm);

        if (p.chart.data.labels.length > 20) {
          p.chart.data.labels.shift();
          p.chart.data.datasets[0].data.shift();
          p.chart.data.datasets[1].data.shift();
        }
        p.chart.update();

        let table = document.getElementById(`table_${p.id}`);
        let row = table.insertRow(0);
        row.insertCell(0).innerText = time;
        row.insertCell(1).innerText = spo2;
        row.insertCell(2).innerText = bpm;
        row.style.backgroundColor = "#1d2833";
        row.style.fontWeight = "bold";
      });
    }, 1000);
  </script>

</body>
</html>

</body>
</html>
